<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom"><title>Vadim Macagon</title><link href="http://vadim.macagon.com/" rel="alternate"></link><link href="http://vadim.macagon.com/feeds%5Cvadim-macagon.atom.xml" rel="self"></link><id>http://vadim.macagon.com/</id><updated>2014-10-29T22:00:00+07:00</updated><entry><title>Build a UE4 compatible static lib in VS2013</title><link href="http://vadim.macagon.com/blog/2014/10/29/build-a-ue4-compatible-static-lib-in-vs2013/" rel="alternate"></link><updated>2014-10-29T22:00:00+07:00</updated><author><name>Vadim Macagon</name></author><id>tag:vadim.macagon.com,2014-10-29:blog/2014/10/29/build-a-ue4-compatible-static-lib-in-vs2013/</id><summary type="html">&lt;div class="section" id="introduction"&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;This is the first tutorial in a two (or maybe three) part series that will explain how to integrate
libraries not built by &lt;abbr title="Unreal Build Tool"&gt;&lt;span class="caps"&gt;UBT&lt;/span&gt;&lt;/abbr&gt; into your &lt;span class="caps"&gt;UE4&lt;/span&gt; games or plugins. This
tutorial will cover building of static libraries in &lt;span class="caps"&gt;VS2013&lt;/span&gt;, but most of this will also apply when
building dynamic&amp;nbsp;libraries.&lt;/p&gt;
&lt;p&gt;We&amp;#8217;re going to build the &lt;a class="reference external" href="http://pugixml.org/"&gt;pugixml&lt;/a&gt; library, a small and lightweight &lt;span class="caps"&gt;XML&lt;/span&gt; processing library written
in C++. I&amp;#8217;ve chosen this library because it doesn&amp;#8217;t have any dependencies, only consists of three
source files, and is easy to configure, so we can focus on the details that are specifically
relevant to Unreal Engine 4. The final &lt;span class="caps"&gt;VS2013&lt;/span&gt; project is available on &lt;a class="reference external" href="https://github.com/enlight/"&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="configure-pugixml"&gt;
&lt;h2&gt;Configure&amp;nbsp;pugixml&lt;/h2&gt;
&lt;p&gt;The library can be configured by editing &lt;strong&gt;pugiconfig.hpp&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Unreal Engine 4 uses the Unicode character set by default (characters are represented by &lt;strong&gt;wchar_t&lt;/strong&gt;
instead of &lt;strong&gt;char&lt;/strong&gt;), so lets enable Unicode support in&amp;nbsp;pugixml:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="cp"&gt;#ifdef UNICODE&lt;/span&gt;
&lt;span class="c1"&gt;// Uncomment this to enable wchar_t mode&lt;/span&gt;
&lt;span class="cp"&gt;#define PUGIXML_WCHAR_MODE&lt;/span&gt;
&lt;span class="cp"&gt;#endif &lt;/span&gt;&lt;span class="c1"&gt;// UNICODE&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Usage of the &lt;abbr title="Standard Template Library"&gt;&lt;span class="caps"&gt;STL&lt;/span&gt;&lt;/abbr&gt; is frowned upon in Unreal Engine 4 code
because it comes with its own set of standard-for-ue4 classes you should use instead. Third party
libraries can still use the &lt;span class="caps"&gt;STL&lt;/span&gt; if needed. pugixml has the ability to use the &lt;span class="caps"&gt;STL&lt;/span&gt; for strings and
streams, but it can also work quite happily without it, so lets remove the &lt;span class="caps"&gt;STL&lt;/span&gt;&amp;nbsp;dependency:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;// Uncomment this to disable STL&lt;/span&gt;
&lt;span class="cp"&gt;#define PUGIXML_NO_STL&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;By default &lt;abbr title="Unreal Build Tool"&gt;&lt;span class="caps"&gt;UBT&lt;/span&gt;&lt;/abbr&gt; will build projects with C++ exceptions disabled,
it&amp;#8217;s best to keep this setting consistent across all the libraries that are linked into
a game project. We can prevent pugixml from throwing C++ exceptions like&amp;nbsp;so:&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre&gt;&lt;span class="c1"&gt;// Uncomment this to disable exceptions&lt;/span&gt;
&lt;span class="cp"&gt;#define PUGIXML_NO_EXCEPTIONS&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="project-properties"&gt;
&lt;h2&gt;Project&amp;nbsp;Properties&lt;/h2&gt;
&lt;div class="section" id="platforms"&gt;
&lt;h3&gt;Platforms&lt;/h3&gt;
&lt;p&gt;We&amp;#8217;ll need to create 32-bit and 64-bit versions of the library. The 32-bit version will be used in
shipping builds (by default), and the 64-bit version will be used in development editor builds.
&lt;span class="caps"&gt;VS2013&lt;/span&gt; sets up a 32-bit platform by default, so we just need to add the 64-bit platform to the
project. To do&amp;nbsp;so:&lt;/p&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;&lt;p class="first"&gt;Right-click on the project in the &lt;span class="caps"&gt;VS2013&lt;/span&gt; &lt;strong&gt;Solution Explorer&lt;/strong&gt;, select &lt;strong&gt;Properties&lt;/strong&gt; from
the context menu, and open the &lt;strong&gt;Configuration Manager&lt;/strong&gt;&amp;nbsp;dialog:&lt;/p&gt;
&lt;img alt="Press on the Configuration Manager button on the Property Pages window." src="/images/pugixml/PugiXml-Property-Pages-01.png" /&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;&lt;br /&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Add a new&amp;nbsp;platform:&lt;/p&gt;
&lt;img alt="Select New from the Active solution platform drop-down." src="/images/pugixml/PugiXml-Property-Pages-02.png" /&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;&lt;br /&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Select &lt;strong&gt;x64&lt;/strong&gt; from the drop-down, and press &lt;strong&gt;&lt;span class="caps"&gt;OK&lt;/span&gt;&lt;/strong&gt;:&lt;/p&gt;
&lt;img alt="Select x64 from the first drop-down." src="/images/pugixml/PugiXml-Property-Pages-03.png" /&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="section" id="general-properties"&gt;
&lt;h3&gt;General&amp;nbsp;Properties&lt;/h3&gt;
&lt;p&gt;The naming convention and directory structure you use for the library binaries is entirely up to
you, however, future tutorials may assume you&amp;#8217;ve set things up as described&amp;nbsp;here.&lt;/p&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;&lt;p class="first"&gt;Select &lt;em&gt;All Configurations&lt;/em&gt; from the &lt;strong&gt;Configuration&lt;/strong&gt;&amp;nbsp;drop-down.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Select &lt;em&gt;Win32&lt;/em&gt; from the &lt;strong&gt;Platform&lt;/strong&gt;&amp;nbsp;drop-down.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Set the following properties on the &lt;strong&gt;Configuration Properties/General&lt;/strong&gt; page as&amp;nbsp;indicated:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;em&gt;Output Directory&lt;/em&gt;: &lt;strong&gt;$(SolutionDir)Build\&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Intermediate Directory&lt;/em&gt;: &lt;strong&gt;$(SolutionDir)Obj\Win32\$(Configuration)\&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Target Name&lt;/em&gt;: &lt;strong&gt;$(ProjectName)-Win32-$(Configuration)&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;&lt;br /&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Press the &lt;strong&gt;Apply&lt;/strong&gt;&amp;nbsp;button.&lt;/p&gt;
&lt;img alt="None" src="/images/pugixml/PugiXml-Property-Pages-04.png" /&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;&lt;br /&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Select &lt;em&gt;x64&lt;/em&gt; from the &lt;strong&gt;Platform&lt;/strong&gt;&amp;nbsp;drop-down.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Set the following properties under the &lt;strong&gt;Configuration Properties/General&lt;/strong&gt; section as&amp;nbsp;indicated:&lt;/p&gt;
&lt;ul class="simple"&gt;
&lt;li&gt;&lt;em&gt;Output Directory&lt;/em&gt;: &lt;strong&gt;$(SolutionDir)Build\&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Intermediate Directory&lt;/em&gt;: &lt;strong&gt;$(SolutionDir)Obj\Win64\$(Configuration)\&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;Target Name&lt;/em&gt;: &lt;strong&gt;$(ProjectName)-Win64-$(Configuration)&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;&lt;br /&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Press the &lt;strong&gt;Apply&lt;/strong&gt;&amp;nbsp;button.&lt;/p&gt;
&lt;img alt="None" src="/images/pugixml/PugiXml-Property-Pages-05.png" /&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;&lt;br /&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Select &lt;em&gt;All Platforms&lt;/em&gt; from the &lt;strong&gt;Platform&lt;/strong&gt;&amp;nbsp;drop-down.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Ensure that the &lt;em&gt;Character Set&lt;/em&gt; property is set to &lt;strong&gt;Use Unicode Character Set&lt;/strong&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;div class="section" id="c-c-properties"&gt;
&lt;h3&gt;C/C++&amp;nbsp;Properties&lt;/h3&gt;
&lt;ol class="arabic"&gt;
&lt;li&gt;&lt;p class="first"&gt;Ensure that &lt;em&gt;All Configurations&lt;/em&gt; and &lt;em&gt;All Platforms&lt;/em&gt; are still&amp;nbsp;selected.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;On the &lt;strong&gt;Configuration Properties/Code Generation&lt;/strong&gt; page set &lt;em&gt;Enable C++ Exceptions&lt;/em&gt; to &lt;strong&gt;No&lt;/strong&gt;,
and press the &lt;strong&gt;Apply&lt;/strong&gt;&amp;nbsp;button.&lt;/p&gt;
&lt;img alt="None" src="/images/pugixml/PugiXml-Property-Pages-06.png" /&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;&lt;br /&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;On the &lt;strong&gt;Configuration Properties/Language&lt;/strong&gt; page set &lt;em&gt;Enable Run-Time Type Information&lt;/em&gt; to &lt;strong&gt;No&lt;/strong&gt;,
and press the &lt;strong&gt;Apply&lt;/strong&gt;&amp;nbsp;button.&lt;/p&gt;
&lt;img alt="None" src="/images/pugixml/PugiXml-Property-Pages-07.png" /&gt;
&lt;div class="line-block"&gt;
&lt;div class="line"&gt;&lt;br /&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Return to the &lt;strong&gt;Configuration Properties/Code Generation&lt;/strong&gt;&amp;nbsp;page.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Select the &lt;em&gt;Debug&lt;/em&gt; configuration, and ensure &lt;strong&gt;Runtime Library&lt;/strong&gt; is set to
&lt;em&gt;Multi-threaded Debug &lt;span class="caps"&gt;DLL&lt;/span&gt; (/MDd)&lt;/em&gt;.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p class="first"&gt;Select the &lt;em&gt;Release&lt;/em&gt; configuration, and ensure &lt;strong&gt;Runtime Library&lt;/strong&gt; is set to
&lt;em&gt;Multi-threaded &lt;span class="caps"&gt;DLL&lt;/span&gt; (/&lt;span class="caps"&gt;MD&lt;/span&gt;)&lt;/em&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div class="section" id="build"&gt;
&lt;h2&gt;Build&lt;/h2&gt;
&lt;p&gt;You can now quickly build all four variants of the library by selecting &lt;strong&gt;Build-&amp;gt;Batch Build&amp;#8230;&lt;/strong&gt;
from the main menu in &lt;span class="caps"&gt;VS2013&lt;/span&gt;.&lt;/p&gt;
&lt;img alt="Tick Build for all Solution Configurations and press the Build button." src="/images/pugixml/PugiXml-Batch-Build.png" /&gt;
&lt;/div&gt;
&lt;div class="section" id="next-time"&gt;
&lt;h2&gt;Next&amp;nbsp;Time&lt;/h2&gt;
&lt;p&gt;We&amp;#8217;re going to cover the linking of the static lib we&amp;#8217;ve just created into a &lt;span class="caps"&gt;UE4&lt;/span&gt; game using
&lt;abbr title="Unreal Build Tool"&gt;&lt;span class="caps"&gt;UBT&lt;/span&gt;&lt;/abbr&gt;.&lt;/p&gt;
&lt;/div&gt;
</summary><category term="ue4"></category><category term="c++"></category></entry></feed>